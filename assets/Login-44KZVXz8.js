import{u as N,a as $,r as f,o as P,b as u,c as C,d as M,w as j,v as z,e,f as i,g as T,h as b,i as B,F as U,j as D,n as I,k as g,t as G,l as n,m as Z,p as A,q as L,s as X}from"./index-yneSRaZ5.js";import{_ as H,a as J}from"./PolicyModal-EH0aXrvl.js";import"./Modal-imUB7Y_K.js";const K=e("div",{class:"mb-4 d-flex align-items-baseline"},[e("h1",{class:"h2 me-auto"}," 登入 ")],-1),O={class:"mb-3"},Q=e("label",{for:"account",class:"form-label"},"帳號（Email）",-1),W={class:"mb-3"},Y={class:"d-flex justify-content-between align-items-center"},ee=e("label",{for:"password",class:"form-label"},"密碼",-1),te={href:"#",class:"text-decoration-none"},se={class:"d-grid gap-2 mb-4"},ae=["disabled"],oe={class:"text-end text-dark"},ie=e("div",{class:"position-relative"},[e("hr"),n(),e("span",{class:"position-absolute top-50 start-50 bg-white text-dark translate-middle px-3"},"或")],-1),ne=e("img",{class:"img-fluid me-1",width:"30",src:J,alt:"teachable-logo"},null,-1),le={class:"text-dark fw-normal"},re={key:0},ce={class:"position-relative d-flex flex-column algin-items-center",style:{height:"100vh"}},de=e("p",{class:"text-center position-absolute",style:{left:"50%",top:"200px",transform:"translateX(-50%)"}},"確認使用者身份中 ...",-1),he={__name:"Login",setup(ue){const{apiPostLogin:q,apiGetLoginTeachable:w}=Z,{apiGetNotifyMessageConstants:V}=A,p=N(),y=$(),F=L(async t=>{await q(t),localStorage.setItem("d_RTfznkkwslIopaqd_account",encodeURIComponent(t.account)),X.toastMessage("success","","登入成功"),p.push("/login/verify")}),r=f(!0);P(async()=>{const{h_redirect:t,h_path:s,redirectType:a,route:o,bind:c}=y.query;if(r.value=!0,D("h_MqhC49RxFRI6pR3Z_token"))try{if((await V()).message==="成功"){if(c==="true"){const l={};l.redirectType=a,l.route=o;const v=new URLSearchParams(l).toString(),d=await w(v);window.location.href=d.redirect_url;return}p.push("/dashboard")}}catch{r.value=!1,window.localStorage.removeItem("h_use_this_user_token_time_limit"),window.localStorage.removeItem("h_MqhC49RxFRI6pR3Z_token_origin"),p.push("/login")}r.value=!1,a&&o&&(localStorage.setItem("t_redirectType",a),localStorage.setItem("t_redirectRoute",o),p.replace({query:{}})),t&&localStorage.setItem("h_redirect",`${t}#${s||"/"}`)});const k=L(async()=>{const{redirectType:t,route:s}=y.query,a={redirectType:"user"};t==="teachable"&&(a.redirectType=t,a.route=s);const o=new URLSearchParams(a).toString(),c=await w(o);window.location.href=c.redirect_url}),x=f(""),m=f(null),R=t=>{x.value=t,t==="user"?m.value.modalTitle="使用者條款":m.value.modalTitle="隱私權政策",m.value.showModal()},_=f(!1),E=()=>{_.value=!_.value};return(t,s)=>{const a=u("VField"),o=u("ErrorMessage"),c=u("router-link"),S=u("VForm"),h=u("Loading");return C(),M(U,null,[j(e("div",null,[i(S,{ref:"form",onSubmit:b(F)},{default:T(({errors:l,meta:v})=>[K,e("div",O,[Q,i(a,{id:"account",name:"account",label:"帳號（Email）",type:"email",class:I(["form-control",{"is-invalid":l.account}]),rules:"required|email"},null,8,["class"]),i(o,{name:"account",class:"invalid-feedback"})]),e("div",W,[e("div",Y,[ee,e("a",te,[e("span",{title:"顯示密碼",class:"bg-transparent material-symbols-outlined d-block fs-5",onClick:g(E,["prevent"])},G(_.value?"visibility_off":"visibility"),1)])]),i(a,{id:"password",name:"password",label:"密碼",type:_.value?"text":"password",class:I(["form-control",{"is-invalid":l.password}]),rules:"required",autocomplete:"current-password"},null,8,["type","class"]),i(o,{name:"password",class:"invalid-feedback"})]),e("div",se,[e("button",{type:"submit",class:"btn btn-primary",disabled:!v.valid}," 登入 ",8,ae),e("p",oe,[n(" 忘記密碼了嗎？"),i(c,{to:"/password/reset",class:"text-primary fw-bold"},{default:T(()=>[n("重設密碼")]),_:1})]),ie,e("button",{type:"button",class:"btn btn-outline-primary d-flex align-items-center justify-content-center",onClick:s[0]||(s[0]=(...d)=>b(k)&&b(k)(...d))},[ne,n(" 以 Teachable 登入或註冊 ")])]),e("h6",le,[n(" 若登入即表示你已經閱讀並接受我們的"),e("a",{href:"#",class:"text-dark",onClick:s[1]||(s[1]=g(d=>R("user"),["prevent"]))},"使用者條款"),n("和"),e("a",{href:"#",class:"text-dark",onClick:s[2]||(s[2]=g(d=>R("private"),["prevent"]))},"隱私權政策"),n("。 ")])]),_:1},8,["onSubmit"])],512),[[z,!r.value]]),r.value?(C(),M("div",re,[e("div",ce,[de,i(h,{"is-full-page":!1,active:!0,"z-index":1060,style:{height:"300px"}})])])):B("",!0),i(H,{ref_key:"policyModalRef",ref:m,status:x.value},null,8,["status"])],64)}}};export{he as default};
