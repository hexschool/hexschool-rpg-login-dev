import{_ as q,r as p,o as D,N as Q,O as W,b as j,c as v,d as g,e as s,f,t as k,F as X,B as Y,n as S,k as E,x as Z,h as z,i as F,s as y,D as ss,g as es,J as ts,K as as}from"./index-yneSRaZ5.js";import{t as os,_ as ns,a as ls}from"./Search-rUTcXfSH.js";import{a as cs}from"./tasks-Ry853RJc.js";import{g as is}from"./date-7SsmXH7N.js";import{T as ds}from"./TaskListItem-i5yFuCc1.js";const _=b=>(ts("data-v-eaf0de18"),b=b(),as(),b),us={class:"container mt-5 mt-md-9"},rs={class:"row"},ps={class:"col-md-4"},vs={class:"col-md-8"},_s=_(()=>s("h4",null,"統計數據",-1)),ms={class:"mb-9"},hs={class:"list-unstyled d-flex"},gs={class:"data-box border rounded-1 d-flex align-items-center justify-content-center me-2"},fs={class:"text-center"},ks=_(()=>s("p",{class:"mb-1"},"完成任務數",-1)),ys={class:"fs-2 mb-0 fw-bold mb-0"},bs={class:"data-box border rounded-1 d-flex align-items-center justify-content-center me-2"},xs={class:"text-center"},ws=_(()=>s("p",{class:"mb-1"},"任務總積分",-1)),Cs={class:"fs-2 mb-0 fw-bold mb-0"},Ts=_(()=>s("h4",null,"任務最新狀態",-1)),Ls={class:"table-responsive tableFixHead"},$s={key:0,class:"table"},Ms=_(()=>s("thead",null,[s("tr",{class:"text-nowrap"},[s("th",{scope:"col",class:"fw-normal bg-white"},"任務名稱"),s("th",{scope:"col",class:"fw-normal bg-white"},"任務狀態"),s("th",{scope:"col",class:"fw-normal bg-white"},"更新時間"),s("th",{scope:"col",class:"fw-normal bg-white"},"查看任務")])],-1)),Bs={class:"table-light"},Ds={scope:"row"},Ss=_(()=>s("span",{style:{"font-size":"18px"},class:"material-symbols-outlined align-middle"},"open_in_new",-1)),Es={key:1,class:"text-center"},zs={class:"mt-9"},Gs=_(()=>s("div",{class:"d-flex flex-wrap justify-content-between"},[s("h4",null,"我的任務列表")],-1)),Hs={class:"my-task-nav nav nav-tabs"},Is={class:"nav-item"},js={class:"nav-item"},Fs={class:"nav-item"},Ns={class:"position-relative",style:{"min-height":"300px"}},Ps={class:"pt-4"},As={key:1,class:"list-unstyled pt-4"},Vs={key:2,class:"d-flex justify-content-center mt-8"},Js=_(()=>s("p",{class:"badge bg-light fs-6 fw-normal rounded-pill py-1 px-3 text-dark lh-base"}," 尚無任務 ",-1)),Ks=[Js],Os={__name:"MyTask",setup(b){const{apiGetMyTask:N,apiGetMyTaskBoard:P,apiGetCompletedTask:G,apiGetExpiredTask:A}=cs,m=os(),c=p([]),r=p({current:1,count:10,next:11}),w=p(0),C=p(0),T=p(!1),L=p([]),V=async()=>{var t,o,n,l;T.value=!0;try{const{tasks:a}=await P();L.value=a}catch(a){y.toastMessage("danger","info",`${(o=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.statusCode}:${(l=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:l.message}`)}T.value=!1};D(()=>{V(),m.groups&&m.groups.length===0&&m.tags&&m.tags.length===0&&m.getGroupsAndTags()});const J=t=>{switch(t){case"等待再次提交":return{backgroundColor:"#3D5950"};case"等待助教回覆":return{backgroundColor:"#798B86"};case"助教已回覆":return{backgroundColor:"#00251A"};case"已審核完成":return{backgroundColor:"#3D5950"};default:return{backgroundColor:"#3D5950"}}},u=p("my"),$=t=>{u.value=t},i=p(!1),H=p(null),x=async(t=1,o=10)=>{var n,l,a,d;i.value=!0;try{const{tasks:e,pagination:h}=await N(t,o,H.value);t>1?c.value=[...c.value,...e]:c.value=e,r.value=h}catch(e){y.toastMessage("danger","info",`${(l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.statusCode}:${(d=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:d.message}`)}i.value=!1},K=async(t=1,o=10)=>{var n,l,a,d;i.value=!0;try{const{task_completed_count:e,task_rewarded_point:h}=await G(t,o);w.value=e,C.value=h}catch(e){y.toastMessage("danger","info",`${(l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.statusCode}:${(d=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:d.message}`)}i.value=!1},M=async(t=1,o=10)=>{var n,l,a,d;i.value=!0;try{const{tasks:e,pagination:h,task_completed_count:R,task_rewarded_point:U}=await G(t,o);w.value=R,C.value=U,t>1?c.value=[...c.value,...e]:c.value=e,r.value=h}catch(e){y.toastMessage("danger","info",`${(l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.statusCode}:${(d=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:d.message}`)}i.value=!1},B=async(t=1,o=10)=>{var n,l,a,d;i.value=!0;try{const{tasks:e,pagination:h}=await A(t,o);t>1?c.value=[...c.value,...e]:c.value=e,r.value=h}catch(e){y.toastMessage("danger","info",`${(l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.statusCode}:${(d=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:d.message}`)}i.value=!1},O=t=>{H.value=t,x(1,10)},I=()=>{const t=document.documentElement;if(t.clientHeight+t.scrollTop>t.scrollHeight&&t.clientHeight+t.scrollTop<t.scrollHeight+6){if(i.value||!r.value.next||r.value.current===r.value.next)return;u.value==="my"?x(r.value.next):u.value==="completed"?M(r.value.next):B(r.value.next)}};return D(()=>{window.addEventListener("scroll",I)}),Q(()=>{window.removeEventListener("scroll",I)}),D(()=>{u.value==="my"?(x(),K()):u.value==="completed"?M():B()}),W(u,t=>{c.value=[],t==="my"?x():t==="completed"?M():B()}),(t,o)=>{const n=j("Loading"),l=j("router-link");return v(),g("div",us,[s("div",rs,[s("div",ps,[f(ls)]),s("div",vs,[_s,s("div",ms,[s("ul",hs,[s("li",gs,[s("div",fs,[ks,s("p",ys,k(w.value),1)])]),s("li",bs,[s("div",xs,[ws,s("p",Cs,k(C.value),1)])])])]),Ts,s("div",null,[f(n,{"is-full-page":!1,active:T.value,"z-index":1060},null,8,["active"]),s("div",Ls,[L.value.length>0?(v(),g("table",$s,[Ms,s("tbody",Bs,[(v(!0),g(X,null,Y(L.value,a=>(v(),g("tr",{class:"text-nowrap position-relative",key:a.id},[s("td",Ds,k(a.name),1),s("td",null,[s("span",{class:"badge rounded-pill py-1 px-3 fw-normal lh-base",style:ss([{"font-size":"14px"},J(a.status)])},k(a.status),5)]),s("td",null,k(z(is)(a.updated_at)),1),s("td",null,[f(l,{to:`/tasks/${a.id}`,class:"stretched-link"},{default:es(()=>[Ss]),_:2},1032,["to"])])]))),128))])])):(v(),g("p",Es,"目前沒有新的任務狀態"))])]),s("div",zs,[Gs,s("ul",Hs,[s("li",Is,[s("a",{class:S(["nav-link",u.value==="my"&&"active"]),href:"#",onClick:o[0]||(o[0]=E(a=>$("my"),["prevent"]))},"我的任務",2)]),s("li",js,[s("a",{class:S(["nav-link",u.value==="completed"&&"active"]),href:"#",onClick:o[1]||(o[1]=E(a=>$("completed"),["prevent"]))},"已完成的任務",2)]),s("li",Fs,[s("a",{class:S(["nav-link",u.value==="expired"&&"active"]),href:"#",onClick:o[2]||(o[2]=E(a=>$("expired"),["prevent"]))},"已過期的任務",2)])]),s("div",Ns,[f(n,{"is-full-page":!1,active:i.value,"z-index":1060},null,8,["active"]),s("div",Ps,[u.value==="my"?(v(),Z(ns,{key:0,tags:z(m).tags,groups:z(m).groups,onSearch:O},null,8,["tags","groups"])):F("",!0),c.value.length>0?(v(),g("ul",As,[f(ds,{type:"task","task-list":c.value},null,8,["task-list"])])):i.value?F("",!0):(v(),g("div",Vs,Ks))])])])])])])}}},Xs=q(Os,[["__scopeId","data-v-eaf0de18"]]);export{Xs as default};
