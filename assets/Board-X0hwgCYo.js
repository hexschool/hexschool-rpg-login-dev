import{_ as K,u as ae,r as n,o as G,z as se,c as r,x as oe,g as le,e as t,d as m,t as b,k as ie,l as ne,i as j,B as O,w as C,U as ce,F as L,M as de,J as Q,K as X,S as re,a as ue,X as fe,O as pe,b as me,f as I,h as H,D as ve,Y as F,W as _e,Z as he,C as ge}from"./index-yneSRaZ5.js";import{_ as ke}from"./Modal-imUB7Y_K.js";import{_ as ye}from"./TaskDescriptionModal-eIBEdLXu.js";import{g as be}from"./date-7SsmXH7N.js";const xe=o=>(Q("data-v-6c6109e1"),o=o(),X(),o),we={class:"mb-6"},$e={key:0,class:"text-primary fs-4 fw-bold mb-0"},Se={key:1,class:"text-primary fs-4 fw-bold mb-0"},Te={key:2,class:"mb-0"},Be=xe(()=>t("span",{class:"align-middle material-symbols-outlined text-success"},"arrow_forward",-1)),Re={class:"row mt-5 g-0"},Ce={class:"col-md-10"},Me={class:"row g-0"},De={class:"form-check form-check-inline"},Pe=["name","id","value","disabled"],Ie=["for"],Le={key:0,class:"text-danger m-0"},Ve={class:"align-items-end col-md-2 d-flex justify-content-end"},ze=["disabled"],Ne={__name:"CertificationModal",props:{data:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})}},emits:["download"],setup(o,{expose:v,emit:h}){const s=ae(),e=o,x=h,S=n(null),$=n(null);G(()=>{$.value=new de(S.value.myBsModal,{keyboard:!1})});const i=()=>{$.value.show()},u=()=>{$.value.hide()};v({showModal:i,hideModal:u});const g=n([]),k=se(()=>e.data.some(f=>!f.enable)),w=f=>{u(),s.push(f)};return(f,y)=>(r(),oe(ke,{ref_key:"myModal",ref:S,title:"目前證書套用名稱為：",size:"lg",hasFooter:!1},{body:le(()=>[t("div",we,[e.user.first_name?(r(),m("p",$e,b(e.user.last_name)+" "+b(e.user.first_name),1)):(r(),m("p",Se,b(e.user.nickname),1)),e.user.first_name?j("",!0):(r(),m("p",Te,[t("a",{href:"#",onClick:y[0]||(y[0]=ie(d=>w("/user"),["prevent"])),class:"link-secondary d-flex align-items-center text-decoration-none"},[ne(" 前往修改真實姓名 "),Be])]))]),t("div",Re,[t("div",Ce,[t("div",Me,[(r(!0),m(L,null,O(e.data,d=>(r(),m("div",{class:"col-md-12",key:d.id},[t("div",De,[C(t("input",{class:"form-check-input",name:d.id,"onUpdate:modelValue":y[1]||(y[1]=V=>g.value=V),type:"checkbox",id:d.id,value:d.id,disabled:!d.enable},null,8,Pe),[[ce,g.value]]),t("label",{class:"form-check-label",for:d.id},b(d.name)+".png",9,Ie)])]))),128)),k.value?(r(),m("p",Le,"*未達完課率的證書不得下載")):j("",!0)])]),t("div",Ve,[t("button",{type:"button",class:"btn btn-dark flex-shrink-0",onClick:y[2]||(y[2]=d=>x("download",g.value)),disabled:!g.value.length},"下載證書",8,ze)])])]),_:1},512))}},Ue=K(Ne,[["__scopeId","data-v-6c6109e1"]]),J=o=>new Promise((v,h)=>{const s=new Image;s.crossOrigin="anonymous",s.src=o,s.onload=()=>v(s),s.onerror=h}),Ee=o=>new FontFace("Noto Sans TC",`url(${o})`).load(),Fe=async(o,v)=>{const h=f=>{const y=f.backingStorePixelRatio||f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/y},s=v,e=s.getContext("2d"),x=h(e);window.innerWidth<1200?(s.style.width="100%",s.style.height="100%"):(s.style.width=`${s.width*1.2}px`,s.style.height=`${s.height*1.2}px`),s.width*=x,s.height*=x,e.scale(x,x);const[S,$,M]=await Promise.all([J(o.template),J("./images/hexschool_logo.svg"),Ee("./font/NotoSansTC-Regular.otf")]);e.fillStyle="white",e.fillRect(0,0,s.width,s.height),e.drawImage(S,0,0,843,596);const i=124,u=M.family,g="rgba(0, 37, 36, 1)",k="rgba(0, 0, 0, 1)",w=205;e.textAlign="left",e.font=`24px ${u}`,e.fillStyle=g,e.fillText(`${o.course_name}`,i,w),e.textAlign="left",e.font=`24px ${u}`,e.fillStyle=g,e.fillText(`${o.title}`,i,w+32),e.beginPath(),e.moveTo(i,w+32+24),e.lineTo(i+350,w+32+24),e.strokeStyle=g,e.lineWidth=2,e.stroke(),e.font=`31px ${u}`,e.fillStyle="black",e.fillText(`${o.student}`,i,318),e.font=`16px ${u}`,e.fillStyle=k,e.fillText(`${o.content}`,i,360),e.font=`16px ${u}`,e.fillStyle=k,e.fillText("特頒此證 以茲證明",i,384),e.drawImage($,i-6,424,114,40),e.font=`14px ${u}`,e.fillStyle=k,e.fillText(`授課老師 ${o.teacher}`,i,473),e.font=`14px ${u}`,e.fillStyle=k,e.fillText(`${o.issue_date.split("T")[0]}`,i+529,473)},T=o=>(Q("data-v-713c200a"),o=o(),X(),o),Ge={class:"board-main"},je={class:"border rounded-1 py-6 px-7"},Oe=T(()=>t("h4",null,"您當前的任務繳交進度",-1)),We={class:"progress",style:{height:"8px"}},Ae=["disabled"],He={class:"mt-9"},Je=T(()=>t("h4",null,"任務最新狀態",-1)),Ke={class:"d-flex flex-wrap align-items-center justify-content-between"},Qe={class:"mb-0"},Xe={class:"d-flex flex-wrap"},Ye={class:"p-2"},Ze={class:"form-check form-check-inline"},qe=T(()=>t("label",{class:"form-check-label",for:"inlineRadio1"},"全部",-1)),et={class:"form-check form-check-inline"},tt=T(()=>t("label",{class:"form-check-label",for:"inlineRadio2"},"審核中",-1)),at={class:"form-check form-check-inline"},st=T(()=>t("label",{class:"form-check-label",for:"inlineRadio3"},"已審核",-1)),ot={class:"d-flex ms-1 align-items-center"},lt=T(()=>t("option",{value:"all"},"全部",-1)),it=["value"],nt=he('<div class="container-fluid bg-dark" data-v-713c200a><div class="row py-2 font-weight-bold mt-3 d-lg-flex d-none" data-v-713c200a><div class="col-lg-3 text-white" data-v-713c200a>最後提交時間</div><div class="col-lg-2 text-white" data-v-713c200a>暱稱</div><div class="col-lg-5 text-white" data-v-713c200a>任務名稱</div><div class="col-lg-2 text-white" data-v-713c200a>任務狀態</div></div></div>',1),ct={class:"position-relative"},dt={class:"position-absolute w-100 calc-special-height"},rt={class:"col-lg-3 col-12 font-weight-bold ps-lg-2"},ut={class:"col-lg-2 col-12"},ft={class:"col-lg-5 col-12"},pt={class:"col-lg-2 col-6"},mt={key:0,class:"d-inline-block bg-dark text-white rounded-pill px-4 py-1",style:{"font-size":"14px"}},vt={key:1,class:"d-inline-block bg-light rounded-pill px-4 py-1",style:{"font-size":"14px"}},_t={__name:"Board",setup(o){const v=re(),h=ue(),s=fe(),{apiGetTrainingTasksBoard:e,apiGetTrainingTasks:x,apiGetTrainingTaskProgress:S,apiGetTrainingCertificates:$,apiGetTrainingCertificate:M}=ge,i=n(""),u=n(null),g=()=>{u.value.showModal()},k=n(!1),w=n(null),f=n([]),y=async c=>{(async()=>{k.value=!0;for(let l=0;l<c.length;l+=1){const _=document.createElement("canvas");_.width=843,_.height=596,document.body.appendChild(_);const{certificate:a}=await M(i.value,c[l]);let P=v.profile.nickname;v.profile.first_name&&(P=`${v.profile.last_name} ${v.profile.first_name}`),Fe({template:a.template_url,course_name:a.training_class_name||"課程名稱",title:a.name||"六角學院",student:P||"學員姓名",content:a.content||"已完成六角學院課程 100% 資格證書",teacher:a.teacher||"廖洧杰",issue_date:new Date().toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})},_).then(()=>{_.toBlob(ee=>{const te=URL.createObjectURL(ee),R=document.createElement("a");R.href=te,R.download=`${a.name}.png`,document.body.appendChild(R),R.click(),document.body.removeChild(R)},"image/png")}),document.body.removeChild(_)}k.value=!1})()},d=n([]),V=async c=>{const{certificates:l}=await $(c);d.value=l},Y=n({name:"",chapters:[]}),D=n(!1),W=n(0),B=n([]),p=n({status:"all",taskId:"all"}),z=n({current:1,next:!1}),N=n(null),U=async(c=1)=>{D.value=!0;let l=`?page=${c}`;p.value.status!=="all"&&(l+=`&status=${p.value.status}`),p.value.taskId!=="all"&&(l+=`&task_id=${p.value.taskId}`);const{total_submit_task_count:_,submit_tasks:a,pagination:P}=await e(i.value,l);W.value=_,c===1?(B.value=a,N.value.scrollTop=0):B.value=[...B.value,...a],z.value=P,D.value=!1};G(()=>{const c=N.value;c.addEventListener("scroll",l=>{B.value.length>0&&l.target.clientHeight+l.target.scrollTop>c.scrollHeight-1&&(!D.value||z.value.next)&&U(z.value.current+1)})}),pe(p,()=>{U()},{deep:!0});const E=n({}),Z=async()=>{const{user_task_progress:c}=await S(i.value);E.value=c},A=n([]),q=async()=>{const{tasks:c}=await x(i.value);A.value=c};return G(()=>{i.value=h.params.id,s.trainingData.id!==h.params.id?s.getTrainingDetail(h.params.id):Y.value=s.trainingData,U(),Z(),q(),V(h.params.id)}),(c,l)=>{const _=me("Loading");return r(),m(L,null,[I(_,{"is-full-page":!0,active:k.value,"z-index":1060},null,8,["active"]),t("div",Ge,[I(ye,{ref_key:"taskDetailModalRef",ref:w,replyData:f.value},null,8,["replyData"]),I(Ue,{ref_key:"certificationModalRef",ref:u,user:H(v).profile,data:d.value,onDownload:y},null,8,["user","data"]),t("div",je,[Oe,t("div",We,[t("div",{class:"progress-bar",role:"progressbar",style:ve({width:`${E.value.completed_task_count/E.value.total_task_count*100}%`}),"aria-valuenow":"25","aria-valuemin":"0","aria-valuemax":"100"},null,4)]),t("button",{class:"btn btn-primary rounded-1 mt-2",onClick:g,disabled:!d.value.length},b(d.value.length?"申請證書":"證書尚未開放下載"),9,Ae)]),t("div",He,[Je,t("div",Ke,[t("p",Qe,"繳交數量: "+b(W.value),1),t("div",Xe,[t("div",Ye,[t("div",Ze,[C(t("input",{class:"form-check-input",type:"radio",name:"boardStatus","onUpdate:modelValue":l[0]||(l[0]=a=>p.value.status=a),id:"inlineRadio1",value:"all"},null,512),[[F,p.value.status]]),qe]),t("div",et,[C(t("input",{class:"form-check-input",type:"radio",name:"boardStatus","onUpdate:modelValue":l[1]||(l[1]=a=>p.value.status=a),id:"inlineRadio2",value:"process"},null,512),[[F,p.value.status]]),tt]),t("div",at,[C(t("input",{class:"form-check-input",type:"radio",name:"boardStatus","onUpdate:modelValue":l[2]||(l[2]=a=>p.value.status=a),id:"inlineRadio3",value:"completed"},null,512),[[F,p.value.status]]),st])]),t("div",ot,[C(t("select",{class:"form-select rounded-1",style:{"min-width":"200px","max-width":"300px"},"aria-label":"Default select example","onUpdate:modelValue":l[3]||(l[3]=a=>p.value.taskId=a)},[lt,(r(!0),m(L,null,O(A.value,a=>(r(),m("option",{value:a.id,key:a.id},b(a.name),9,it))),128))],512),[[_e,p.value.taskId]])])])]),nt,t("div",ct,[t("div",dt,[I(_,{"is-full-page":!1,active:D.value,"z-index":1060},null,8,["active"])]),t("div",{class:"task-board",ref_key:"taskBoardRef",ref:N},[(r(!0),m(L,null,O(B.value,a=>(r(),m("div",{key:a.id,class:"d-flex flex-wrap bg-white py-2 align-items-center border-bottom"},[t("div",rt,b(H(be)(a.updated_at)),1),t("div",ut,b(a.nickname),1),t("div",ft,b(a.task_name),1),t("div",pt,[a.status==="process"?(r(),m("span",mt,"審核中")):a.status==="completed"?(r(),m("span",vt,"已審核")):j("",!0)])]))),128))],512)])])])],64)}}},xt=K(_t,[["__scopeId","data-v-713c200a"]]);export{xt as default};
