import{_ as K,r as w,o as j,c as b,x as H,g,e,l as I,t as A,M as O,J as Q,K as W,S as X,b as F,d as y,f as l,h as t,w as P,T as z,i as Y,n as p,U as ee,q as k,s as f,y as se,p as ae,m as oe}from"./index-yneSRaZ5.js";import{_ as te}from"./Modal-imUB7Y_K.js";const le=v=>(Q("data-v-02cc4ee3"),v=v(),W(),v),ne={class:"highlight-name"},ie=le(()=>e("p",{class:"text-danger"},"請注意，一但儲存將無法再次修改，請確認輸入內容無誤。",-1)),de={class:"text-end"},re={__name:"CheckUserNameModal",props:{name:{type:String,required:!0}},emits:["submitUserName","reset"],setup(v,{expose:N,emit:S}){const $=v,M=S,V=w(null),o=w(null);j(()=>{o.value=new O(V.value.myBsModal,{keyboard:!1,backdrop:"static"})});const m=()=>{o.value.show()},x=()=>{M("reset"),o.value.hide()};return N({showModal:m,hideModal:x}),(Z,U)=>(b(),H(te,{ref_key:"myModal",ref:V,title:"設定真實姓名",hasFooter:!1},{body:g(()=>[e("p",null,[I(" 您輸入的真實姓名為 "),e("span",ne,[e("b",null,A($.name),1)])]),ie,e("div",de,[e("button",{type:"button",class:"btn btn-danger me-2",onClick:x},"取消"),e("button",{type:"button",class:"btn btn-primary",onClick:U[0]||(U[0]=u=>M("submitUserName"))},"確認")])]),_:1},512))}},ce=K(re,[["__scopeId","data-v-02cc4ee3"]]),me={class:"col-md-8 mt-md-0 mt-4"},ue={class:"border rounded-4 p-6"},_e=e("h1",{class:"fs-4 mb-3"},"個人資訊",-1),pe={class:"row"},fe={class:"col-md-6"},be={class:"mb-3"},we=e("label",{for:"nickname",class:"form-label"},"暱稱",-1),ve=["disabled"],he=e("hr",null,null,-1),ye={key:0},ke=e("p",{class:"mb-1"},"真實姓名",-1),ge={class:"h5 mb-1"},Me={key:1},Ve={class:"row"},xe={class:"col-xl-3 col-md-6"},Ue=e("label",{for:"last_name",class:"form-label"},"真實姓名（姓氏）",-1),Pe={class:"col-xl-3 col-md-6"},Ne=e("label",{for:"first_name",class:"form-label"},"真實姓名（名字）",-1),Se=e("div",{class:"text-gentle_green small mb-2"}," 此為課程證書使用名稱 ",-1),$e=["disabled"],Ce=e("div",{class:"row"},[e("div",{class:"col-xl-6"},[e("hr")])],-1),Fe={class:"row"},ze={class:"col-md-6"},Ae=e("div",{class:"mb-3 visually-hidden"},[e("label",{for:"username",class:"form-label"},"Username"),e("input",{id:"username",type:"text",class:"form-control",name:"username",autocomplete:"username"})],-1),Ze={class:"mb-3"},qe=e("label",{for:"old_password",class:"form-label"},"舊密碼",-1),Ee={class:"mb-3"},Te=e("label",{for:"new_password",class:"form-label"},"新密碼",-1),Be={class:"mb-2"},De=e("label",{for:"confirm_new_password",class:"form-label"},"確認新密碼",-1),Re={class:"form-check mb-2"},Ie=e("label",{class:"form-check-label",for:"showPassword"}," 顯示密碼 ",-1),Le=["disabled"],Ge=e("hr",null,null,-1),Je={class:"mb-3"},Ke=e("label",{for:"email",class:"form-label"},"Email",-1),je={class:"mb-3"},He={for:"teachableEmail",class:"form-label"},Oe={key:0,class:"badge text-bg-primary ms-1"},Qe={key:0},We={key:1},Xe={class:"d-grid mt-1"},Ye=e("hr",null,null,-1),es={class:"row"},ss={class:"col-md-8"},as={class:"mb-3"},os=e("label",{for:"description",class:"form-label"},"個人簡介",-1),ts=["disabled"],is={__name:"UserProfile",setup(v){const{apiPostUserName:N,apiPutUserNickname:S,apiPutUserPassword:$,apiPutUserDescription:M}=ae,{apiGetLoginTeachable:V}=oe,o=X(),h=w(!1),m=w({}),x=k(async()=>{var c,s,n,d;try{const a={nickname:o.profile.nickname};await S(a),o.getUserProfile(),f.toastMessage("success","","更新成功")}catch(a){f.toastMessage("danger","info",`${(s=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:s.statusCode}:${(d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message}`)}}),Z=k(async()=>{const c={old_password:m.value.old_password,new_password:m.value.new_password,confirm_new_password:m.value.confirm_new_password};await $(c),o.getUserProfile(),f.toastMessage("success","","更新成功"),document.cookie=`h_MqhC49RxFRI6pR3Z_token=;${se()};`,setTimeout(()=>{window.location.href="/login"},1e3)}),U=k(async()=>{var c,s,n,d;try{const a={description:o.profile.description||""};await M(a),o.getUserProfile(),f.toastMessage("success","","更新成功")}catch(a){f.toastMessage("danger","info",`${(s=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:s.statusCode}:${(d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message}`)}}),u=w({last_name:"",first_name:""}),C=w(null),L=()=>{C.value.showModal()},q=w(null),G=()=>{q.value.resetForm()},J=k(async()=>{var c,s,n,d;try{const a={last_name:u.value.last_name||"",first_name:u.value.first_name||""};await N(a),o.getUserProfile(),f.toastMessage("success","","新增真實姓名成功")}catch(a){f.toastMessage("danger","info",`${(s=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:s.statusCode}:${(d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message}`)}C.value.hideModal()}),E=k(async()=>{const c={redirectType:"user"},s=new URLSearchParams(c).toString(),n=await V(s);window.location.href=n.redirect_url});return(c,s)=>{var T,B,D,R;const n=F("VField"),d=F("ErrorMessage"),a=F("VForm");return b(),y("div",me,[e("div",ue,[_e,e("div",pe,[e("div",fe,[l(a,{ref:"nicknameForm",onSubmit:t(x)},{default:g(({errors:i,meta:_})=>[e("div",be,[we,l(n,{id:"nickname",modelValue:t(o).profile.nickname,"onUpdate:modelValue":s[0]||(s[0]=r=>t(o).profile.nickname=r),modelModifiers:{trim:!0},name:"nickname",label:"暱稱",type:"text",class:p(["form-control",{"is-invalid":i.nickname}]),rules:{required:!0,regex:/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9 \u4e00-\u9fa5_-]{0,18}[a-zA-Z0-9\u4e00-\u9fa5_-]$/}},null,8,["modelValue","class"]),l(d,{name:"nickname",class:"invalid-feedback"})]),e("button",{type:"submit",class:"btn btn-primary",disabled:!_.valid}," 確認修改 ",8,ve)]),_:1},8,["onSubmit"]),he])]),(T=t(o).originProfile)!=null&&T.last_name&&((B=t(o).originProfile)!=null&&B.first_name)?(b(),y("div",ye,[ke,e("p",ge,A((D=t(o).originProfile)==null?void 0:D.last_name)+A((R=t(o).originProfile)==null?void 0:R.first_name),1)])):(b(),y("div",Me,[l(ce,{ref_key:"checkUserNameModal",ref:C,onSubmitUserName:t(J),onReset:G,name:u.value.last_name&&u.value.first_name?u.value.last_name+u.value.first_name:""},null,8,["onSubmitUserName","name"]),l(a,{ref_key:"nameForm",ref:q,onSubmit:L},{default:g(({errors:i,meta:_})=>[e("div",Ve,[e("div",xe,[Ue,l(n,{id:"last_name",modelValue:u.value.last_name,"onUpdate:modelValue":s[1]||(s[1]=r=>u.value.last_name=r),modelModifiers:{trim:!0},name:"last_name",label:"真實姓名（姓氏）",type:"text",class:p(["form-control",{"is-invalid":i.last_name}]),rules:{required:!0,regex:/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9 \u4e00-\u9fa5_-]{0,11}$/}},null,8,["modelValue","class"]),l(d,{name:"last_name",class:"invalid-feedback"})]),e("div",Pe,[Ne,l(n,{id:"first_name",modelValue:u.value.first_name,"onUpdate:modelValue":s[2]||(s[2]=r=>u.value.first_name=r),modelModifiers:{trim:!0},name:"first_name",label:"真實姓名（名字）",type:"text",class:p(["form-control",{"is-invalid":i.first_name}]),rules:{required:!0,regex:/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9 \u4e00-\u9fa5_-]{0,11}$/}},null,8,["modelValue","class"]),l(d,{name:"first_name",class:"invalid-feedback"})]),Se]),e("button",{type:"submit",class:"btn btn-primary",disabled:!_.valid}," 確認修改 ",8,$e)]),_:1},512)])),Ce,e("div",Fe,[e("div",ze,[l(a,{ref:"passwordForm",onSubmit:t(Z)},{default:g(({errors:i,meta:_})=>[Ae,e("div",Ze,[qe,l(n,{id:"old_password",modelValue:m.value.old_password,"onUpdate:modelValue":s[3]||(s[3]=r=>m.value.old_password=r),modelModifiers:{trim:!0},name:"old_password",label:"舊密碼",type:h.value?"text":"password",class:p(["form-control",{"is-invalid":i.old_password}]),rules:"required",autocomplete:"current-password"},null,8,["modelValue","type","class"]),l(d,{name:"old_password",class:"invalid-feedback"})]),e("div",Ee,[Te,l(n,{id:"new_password",modelValue:m.value.new_password,"onUpdate:modelValue":s[4]||(s[4]=r=>m.value.new_password=r),modelModifiers:{trim:!0},name:"new_password",type:h.value?"text":"password",label:"新密碼",class:p(["form-control",{"is-invalid":i.new_password}]),rules:{required:!0,regex:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,16}$/},autocomplete:"new-password"},null,8,["modelValue","type","class","rules"]),l(d,{name:"new_password",class:"invalid-feedback"})]),e("div",Be,[De,l(n,{id:"confirm_new_password",modelValue:m.value.confirm_new_password,"onUpdate:modelValue":s[5]||(s[5]=r=>m.value.confirm_new_password=r),modelModifiers:{trim:!0},name:"confirm_new_password",type:h.value?"text":"password",label:"確認新密碼",class:p(["form-control",{"is-invalid":i.confirm_new_password}]),rules:"required|confirmed:@new_password",autocomplete:"new-password"},null,8,["modelValue","type","class"]),l(d,{name:"confirm_new_password",class:"invalid-feedback"})]),e("div",Re,[P(e("input",{"onUpdate:modelValue":s[6]||(s[6]=r=>h.value=r),class:"form-check-input",type:"checkbox",id:"showPassword"},null,512),[[ee,h.value]]),Ie]),e("button",{type:"submit",class:"btn btn-primary",disabled:!_.valid}," 確認修改 ",8,Le)]),_:1},8,["onSubmit"]),Ge,e("div",Je,[Ke,P(e("input",{type:"email","onUpdate:modelValue":s[7]||(s[7]=i=>t(o).profile.email=i),class:"form-control",id:"email",disabled:""},null,512),[[z,t(o).profile.email]])]),e("div",je,[e("label",He,[I("Teachable 登入 "),t(o).thirdparty[0].email!==""?(b(),y("span",Oe,"連動中")):Y("",!0)]),t(o).thirdparty[0].email!==""?(b(),y("div",Qe,[P(e("input",{type:"email","onUpdate:modelValue":s[8]||(s[8]=i=>t(o).thirdparty[0].email=i),class:"form-control",id:"teachableEmail",disabled:""},null,512),[[z,t(o).thirdparty[0].email]])])):(b(),y("div",We,[P(e("input",{type:"email","onUpdate:modelValue":s[9]||(s[9]=i=>t(o).thirdparty[0].email=i),class:"form-control",id:"teachableEmail"},null,512),[[z,t(o).thirdparty[0].email]]),e("div",Xe,[e("input",{type:"button",class:"btn btn-primary",id:"teachableEmail",value:"連結",onClick:s[10]||(s[10]=(...i)=>t(E)&&t(E)(...i))})])]))]),Ye])]),e("div",es,[e("div",ss,[l(a,{ref:"descriptionForm",onSubmit:t(U)},{default:g(({errors:i,meta:_})=>[e("div",as,[os,l(n,{id:"description",as:"textarea",modelValue:t(o).profile.description,"onUpdate:modelValue":s[11]||(s[11]=r=>t(o).profile.description=r),modelModifiers:{trim:!0},label:"個人簡介",name:"description",class:p(["form-control",{"is-invalid":i.description}]),rows:"4",placeholder:"請輸入你的個人簡介，字數限制 500 字",rules:"max:500"},null,8,["modelValue","class"]),l(d,{name:"description",class:"invalid-feedback"})]),e("button",{type:"submit",class:"btn btn-primary",disabled:!_.valid}," 確認修改 ",8,ts)]),_:1},8,["onSubmit"])])])])])}}};export{is as default};
